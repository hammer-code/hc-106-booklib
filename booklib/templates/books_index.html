{% extends "base.html" %} {% block title %}Books{% endblock %} {% block content
%}
<section>
  <h1 class="text-center font-bold text-2xl mb-5">Data Book</h1>
  <a
    class="px-4 py-2 bg-blue-500 rounded text-white"
    href="{{ url_for('books_create') }}"
    >Add new</a
  >
  <table class="mt-5 table-auto w-full border-collapse border border-black">
    <thead>
      <tr>
        <th class="border border-black">#</th>
        <th class="border border-black">Image</th>
        <th class="border border-black">Title</th>
        <th class="border border-black">Author</th>
        <th class="border border-black">Published</th>
        <th class="border border-black">Quantity</th>
        <th class="border border-black">Action</th>
      </tr>
    </thead>
    <tbody id="list">
      {% if books %} {% for book in books %}
      <tr>
        <td class="text-center border border-black">{{ loop.index }}</td>
        <td class="border border-black px-2 text-center">
          <img class="w-32" src="{{ book.image_url }}" alt="{{ book.title }}" />
        </td>
        <td class="border border-black px-2">{{ book.title }}</td>
        <td class="border border-black px-2">{{ book.author }}</td>
        <td class="border border-black px-2">{{ book.published }}</td>
        <td class="border border-black px-2 text-center">
          {{ book.quantity }}
        </td>
        <td class="border border-black px-2">
          <a
            href="{{ url_for('books_edit', book_id=book.id) }}"
            class="text-blue-500"
            >Edit</a
          >
          <button
            class="text-red-500"
            onclick="handleDelete(event, {{ book.id }})"
          >
            Delete
          </button>
        </td>
      </tr>
      {% endfor %} {% else %}
      <tr>
        <td class="text-center border border-black px-2" colspan="7">
          Data is empty
        </td>
      </tr>
      {% endif %}
    </tbody>
  </table>
</section>
<script>
  const handleDelete = function (e, id) {
    const list = document.getElementById("list");
    const tr = e.target.parentNode.parentNode;
    if (!confirm("Are you sure you want to delete this?")) {
      return;
    }

    fetch(`/books/delete/${id}`, {
      method: "POST",
    }).then(() => {
      list.removeChild(tr);
      if (list.children.length === 0) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.classList = "border border-black px-2 text-center";
        td.setAttribute("colspan", 7);
        td.innerHTML = "Data is empty";
        tr.appendChild(td);
        list.appendChild(tr);
      }
    });
  };
</script>
{% endblock %}
